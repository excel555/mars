<style type="text/css">
    td.name {
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    table{
        font-size: 13px;
    }
</style>
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">优惠券列表</h3>
    </div>
    <div class="panel-body">
        <div class="form-horizontal" id="search">
            <!--<{include 'order/search_box.html'}>-->
            <div class="form-group">
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="search_card_number" placeholder="卡号">
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="search_uid" placeholder="用户id或手机号或用户名" value="<{$uid}>">
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="search_tag" placeholder="券tag码">
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control" name="search_card_active_id" placeholder="活动发券id">
                </div>
                <div class="col-sm-2">
                    <select class="form-control" name="search_card_source">
                        <option value="0">领券来源</option>
                        <option value="1">后台发券</option>
                        <option value="2">开门领券</option>
                        <option value="3">活动领券</option>
                    </select>
                </div>
                <div class="col-sm-2">
                    <select class="form-control" name="search_is_used">
                        <option value="-1">是否使用</option>
                        <option value="0">未使用</option>
                        <option value="1">已使用</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-2">
                    <button type="button" class="btn btn-default" id="search-btn">查找</button>
                    <input type="hidden" id="origin_url" value="/card/card_table">
                </div>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <div class="table-toolbar">
            <button type="button" class="btn btn-info btn-sm" onclick="location.href='/card/card_add'">新增</button>&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="hidden" id="curr_id" value="0">
        </div>
        <div id="config-body">
            <table id="config-table" data-toggle="table" data-pagination="true" data-side-pagination="server" data-page-list="[5,10,15,20]">
                <thead>
                <tr>
                    <th data-field="state" data-radio="true"></th>
                    <th data-field="id" data-align="center">ID</th>
                    <th data-field="card_number" data-align="center">卡号</th>
                    <th data-field="card_money" data-align="center">卡内金额</th>
                    <th data-field="card_source" data-align="center">领券来源</th>
                    <th data-field="is_used" data-align="center">是否被使用</th>
                    <th data-field="begin_date" data-align="center">开始时间</th>
                    <th data-field="to_date" data-align="center">结束时间</th>
                    <th data-field="card_name" data-align="center">优惠券名称</th>
                    <th data-field="source" data-align="center">使用渠道</th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">

        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<script type="text/javascript">

    $(function(){
        $('#config-table').bootstrapTable({
        }).on('click-row.bs.table', function (e, row, $element) {
            $("#curr_id").val(row.id);
        });
        var url =  '/card/card_table?search_uid=<{$uid}>';
        $('#config-table').bootstrapTable('refresh', {url: url});
        $("#search-btn").on('click', function(){
            var serverUrl = $('#origin_url').val();
            var filterData = "";
            $.each($("[name^='search_']"), function() {
                field = $(this).attr('name');
                data = $(this).val();
                if(data!=-1 && data!=""){
                    filterData += field+"="+data+"&";
                }
            });
//            console.log(serverUrl,filterData);
            var url = serverUrl;

            if(filterData!=""){
                var url = url+'?'+filterData;
            }

//            console.log(serverUrl,filterData);

            $('#config-table').bootstrapTable('refresh', {url: url});
        });

        //编辑
        $("#active-edit").on('click', function () {
            ckRadio();
            var curr_id = $("#curr_id").val();
            if (curr_id == 0) {
                MessageBox.error('请选择编辑项');
                return;
            }
            window.location.href = "/card/card_model_edit/" + curr_id;
        });


    });

    function ckRadio() {
        var curr_id = $("input[type=radio]:checked").parent().next().text();
        if (typeof (curr_idserverUrl) == "undefined") {
            $("#curr_id").val(0);
        } else {
            $("#curr_id").val(curr_id);
        }
    }
</script>