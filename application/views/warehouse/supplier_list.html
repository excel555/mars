<style type="text/css">
	.pagination-detail { padding-left: 10px }

	.pagination { padding-right: 10px }

	table {
		font-size: 12px;
	}
</style>
<div class="panel panel-default">
	<div class="panel-heading">
		<div class="pull-left toolbar">
			<span class="btn btn-info btn-sm btn-add">新增供应商</span>
		</div>
		<div class="pull-right form-inline searchbar">
            <div class="form-group form-group-sm">
                <input type="text" class="form-control" name="contacts" placeholder="联系人或手机">
            </div>
			<div class="form-group form-group-sm">
				<input type="text" class="form-control" name="name" placeholder="名称或ID">
			</div>
			<div class="form-group">
				<button type="button" class="btn btn-default btn-sm btn-search">查找</button>
			</div>
		</div>

		<div style="clear: both"></div>
	</div>
</div>
<table id="tableBody" class="table table-striped"></table>
<div class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content"></div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        var toolbar = $('.toolbar');
        var searchbar = $('.searchbar');
        var table = $('#tableBody'),
            modal = $('.modal'),
            modalContent = $('.modal-content');

        var columns = [
            {field: 'id', title: 'ID'},
            {field: 'name', title: '名称'},
            {field: 'code', title: '编码'},
            {field: 'contacts', title: '联系人'},
            {field: 'mobile', title: '联系人手机'},
            {field: 'address', title: '地址'},
            {field: 'is_enabled', title: '是否启用', formatter: function(value, row, index){
	            return value == 1 ? '启用' : '未启用';
                }
	        },
            {
                field: 'operation', title: '操作', align: 'center',
                formatter: function (value, row, index) {
                    return ['<span data-id="' + row.id + '" class="btn btn-xs btn-info btn-edit">编辑</span>'].join('');
                }
            }
        ];
        
        function queryParams(params) {
            params = params || {};
            searchbar.find('input, select').each(function () {
                var _this = $(this), _val = $.trim(_this.val()), _tagName = _this.get(0).tagName;
                if ((_tagName == 'INPUT' && _val != '') || (_tagName == 'SELECT' && _val != '-1')) {
                    var name = $(this).find("option:selected").data('name') || $(this).data('name') || $(this).attr('name');
                    params[name] = _val;
                }

            });
            return params;
        }
        table.bootstrapTable({
            url: '/warehouse/supplier_data/',
            columns: columns,
            sidePagination: "server",
            queryParams: queryParams,
            pagination: true,
            pageSize: 10,
            pageList: [10, 25, 50, 100]
        });

        table.on('click', '.btn-edit', function(){
            modalContent.html('loading...');
            $.ajax({
                url: '/warehouse/supplier_add/' + $(this).data('id'),
                type: "POST",
                dataType: 'html',
                success: function (resp) {
                    modalContent.html(resp);
                    modal.modal('show');
                }
            });
        });

        toolbar.on('click', '.btn-add', function () {
            modalContent.html('loading...');
            $.ajax({
                url: '/warehouse/supplier_add/',
                type: "POST",
                dataType: 'html',
                success: function (resp) {
                    modalContent.html(resp);
                    modal.modal('show');
                }
            });
        });

        modalContent.on('click', '.btn-save', function(){
            var _this = $(this);
            _this.addClass('disabled');
            var data = modalContent.find('form').serialize();
            $.ajax({
                url: '/warehouse/supplier_save/',
                type: "POST",
                dataType: 'json',
                data: data,
                error: function(jqXHR, textStatus, errorThrown){
                    MessageBox.error(errorThrown);
                },
                success: function (resp) {
                    if(resp.status != 'y'){
                        MessageBox.error(resp.msg);
                        _this.removeClass('disabled');
                        return;
                    }
                    modal.modal('hide');
                    MessageBox.success('保存成功');
                    table.bootstrapTable('refresh');
                }
            });
        });

        searchbar.on('click', '.btn-search', function () {
            table.bootstrapTable('refresh');
        });

    });
</script>