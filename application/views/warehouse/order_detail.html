<div class="panel panel-default">
	<div class="panel-body">
		<form class="form-horizontal">
			<div class="form-group">
				<label class="col-sm-2 control-label"><{$keyObj.name}>仓位</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="stock_out_name" value="<{$detail['name']}>" readonly>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label"><{$keyObj.name}>备注</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="stock_out_name" value="<{$detail[$key|cat:'_name']}>" placeholder="如:出库火龙果" datatype="*" nullmsg="请输入出库名称" readonly>
				</div>
			</div>

			<{if $key == 'allocate'}>
			<div class="form-group">
				<label class="col-sm-2 control-label">供应商</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="supplier_name" value="<{$detail['supplier_name']}>"  readonly>
				</div>
			</div>
			<{/if}>

			<{if $key == 'stock_in'}>
			<div class="form-group">
				<label class="col-sm-2 control-label">入库类型</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="type" value="<{$keyObj['type'][$detail['type']]}>"  readonly>
				</div>
			</div>
			<{/if}>

			<{if $key == 'stock_out'}>
			<div class="form-group">
				<label class="col-sm-2 control-label">出库类型</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="type" value="<{$keyObj['type'][$detail['type']]}>"  readonly>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">是否贴标</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="type" value="<{if $detail['is_label'] == 1}>是<{else}>否<{/if}>"  readonly>
				</div>
			</div>
			<{/if}>

			<{if $key == 'lose_report'}>
			<div class="form-group">
				<label class="col-sm-2 control-label">报损类型</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="type" value="<{$keyObj['type'][$detail['type']]}>"  readonly>
				</div>
			</div>
			<{/if}>

			<div class="form-group">
				<label class="col-sm-2 control-label">操作人</label>
				<div class="col-sm-5">
					<input type="text" class="form-control" name="stock_out_admin_name" value="<{$detail[$key|cat:'_admin_name']}>" id="stock_out_admin_name" datatype="*" readonly>
				</div>
				<div class="col-sm-5 control-label"><div class="itemTotal"></div></div>
			</div>

		</form>
		<div class="row">
			<div class="form-group">
				<label class="col-sm-2 control-label text-right"><{$keyObj.name}>明细</label>
				<div class="col-sm-10">
					<table id="tableData" class="table table-striped"></table>
				</div>
			</div>
		</div>

	</div>
</div>

<link href="/assets/bootstrap/css/bootstrap-editable.css" rel="stylesheet"/>
<script src="/assets/bootstrap/js/bootstrap-editable.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap-table-editable.js" type='text/javascript'></script>
<script type="text/javascript">
    (function () {
        var id = '<{$detail["id"]}>';
        var key = '<{$key}>';
        var name = '<{$keyObj.name}>';
        var columns = [
            {field: 'product_id', title: '商品ID'},
            {field: 'product_name', title: '商品名称'},
            {field: 'pro_code', title: '商品编码'}
        ];

        switch (key){
	        case 'check':
                columns.push(
                    {
                        field: key + '_stock_before', title: name + '前库存量'
                    },
                    {
                        field: 'stock_onway', title: '在途数量'
                    }
                );
                break;
            case 'stock_in':
                columns.push(
                    {
                        field: 'stock_onway', title: '在途数量'
                    }
                );
                break;
	        default:

	            break;
        }
        columns.push({
            field: key + '_num', title: name + '量',
            /*editable: {
				type: 'text',
				validate: function (v) {
					if (v<=0){
						return '格式错误, 不能 <= 0'
					}
				}
			}*/
        });
        if(key == 'allocate'){
        	columns.splice(3,0,
                	{
                        field: 'supplier_box_qty', title: '箱入数'
                    },
                    {
                        field: 'purchase_price', title: '进价'
                    }
                );
        		columns.push({
                    field: 'real_num', title: '实际到货'
                });
        }

        var table = $('#tableData');
        table.bootstrapTable({
            url: '/warehouse/order_products/' + key + '/' + id,
            columns: columns,
            sidePagination: "server",
            uniqueId: 'product_id',
            onPostBody:function (data) {
                data = data || [];
                var qty = 0;
                var stock_onway = 0;
                $.each(data, function(){
                    qty += parseInt(this[key+'_num']);
                    stock_onway += parseInt(this['stock_onway']);
                });
                var txt = ' 商品数量: <span class="label label-warning">'+data.length+'</span> ';
                if(key=='stock_in' || key=='check'){
                    txt += '在途数量: <span class="label label-danger">'+stock_onway+'</span> ';
                }
                txt += name+'量: <span class="label label-primary">'+qty+'</span> ';
                $('.itemTotal').html(txt);
            },
            onEditableSave: function (field, row, oldValue, $el) {
                $.ajax({
                    url: '/warehouse/order_product_editable/' + key + '/' + row.id,
                    type: "POST",
                    data: {field: field, value: row[field]},
                    dataType: 'json',
                    success: function (resp) {
                        var set = row;
                        if (resp.status != 'y') {
                            set = oldValue;
                        }
                        table.bootstrapTable('updateByUniqueId', set);
                    }
                });
            }
        });
    })();
</script>