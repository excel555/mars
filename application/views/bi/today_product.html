<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">实时商品榜单</h3>
    </div>
    <div class="panel-body">
        <div class="form-horizontal">
            <form action="/bi/today_table" method="get" id="sale_form">
                <{include 'bi/search_box.html'}>
                <div class="form-group">
                    <{include 'bi/search_product.html'}>
                    <div class="col-sm-5">
                        <label>
                            <input type="text" class="form-control" name="search_product_name"  value="" placeholder="商品名称" >
                        </label>
                    </div>
                    <button type="button" class="btn btn-info" onclick="search_result(0)">查找</button>
                </div>
            </form>
        </div>
    </div>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" style="color: #AAAAAA;">&nbsp;&nbsp;&nbsp;更新时间:<{$today_time}>,&nbsp;&nbsp;数据统计自当日实时实付订单</a>
            </div>
            <div>
                <a class="navbar-brand pull-right" id="explore_result" style="border-radius: 5px;background-color: #222;border: 1px solid #222;">导出</a>
            </div>
        </div>
    </nav>
    <div class="panel-body">
        <div id="config-body">
            <table id="config-table" data-toggle="table" data-url="/bi/today_table" data-pagination="true" data-side-pagination="server" data-page-size="50"  data-page-list="[100,50,20]" data-sort-order="desc">
                <thead>
                <tr>
                    <th data-field="key" data-align="center">排名</th>
                    <th data-field="product_name" data-align="center">商品名称</th>
                    <th data-field="sale_num" data-align="center" data-sortable="true">实付商品件数</th>
                    <th data-field="order_num" data-align="center" data-sortable="true">实付订单数</th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
    function search_result(){
        var serverUrl = '/bi/today_table';
        var filterData = "";
        $.each($("[name^='search_']"), function() {
            field = $(this).attr('name');
            data = $(this).val();
            if($(this).attr('type') == 'radio' &&  $(this).prop('checked')==false){
                return ;
            }
            if(data!=-1 && data!=""){
                filterData += field+"="+data+"&";
            }
        });
        if(filterData==""){
            var url = serverUrl;
        }else{
            var url = serverUrl +'?'+filterData;
        }
        $('#config-table').bootstrapTable('refresh', {url: url}).on('load-success.bs.table', function (e,data) {
//            $('.order_total').text(data.total);
//            $('.order_money').text(data.money);

        });
    }




    $(document).ready(function(){

        $('#time').datetimepicker({
            language: 'zh', //汉化
            autoclose: 1,
            format: 'yyyy-mm-dd',
            minView: 'month'
        });
        $('#time1').datetimepicker({
            language: 'zh', //汉化
            autoclose: 1,
            format: 'yyyy-mm-dd',
            minView: 'month'
        });
        $('#time2').datetimepicker({
            language: 'zh', //汉化
            autoclose: 1,
            format: 'yyyy-mm-dd',
            minView: 'month'
        });

        //导出
        $("#explore_result").on('click', function(){
            var serverUrl = '/bi/today_table';
            var filterData = "";
            $.each($("[name^='search_']"), function() {
                field = $(this).attr('name');
                data = $(this).val();
                if(data!=-1 && data!=""){
                    filterData += field+"="+data+"&";
                }
            });
            if(filterData==""){
                var url = serverUrl+'?is_explore=1';
            }else{
                var url = serverUrl +'?'+filterData+'is_explore=1';
            }
            location.href=url;
        });

    });

</script>